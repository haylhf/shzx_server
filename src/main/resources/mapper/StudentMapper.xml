<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eservice.api.dao.StudentMapper">
  <resultMap id="BaseResultMap" type="com.eservice.api.model.student.Student">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="student_number" jdbcType="VARCHAR" property="studentNumber" />
    <result column="head_img" jdbcType="VARCHAR" property="headImg" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="banji" jdbcType="INTEGER" property="banji" />
    <result column="bus_morning" jdbcType="INTEGER" property="busMorning" />
    <result column="bus_afternoon" jdbcType="INTEGER" property="busAfternoon" />
    <result column="board_station_morning" jdbcType="INTEGER" property="boardStationMorning" />
    <result column="board_station_afternoon" jdbcType="INTEGER" property="boardStationAfternoon" />
    <result column="family_info" jdbcType="LONGVARCHAR" property="familyInfo" />
  </resultMap>
  <resultMap id="StudentInfoResultMap" type="com.eservice.api.model.student.StudentInfo">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="student_number" jdbcType="VARCHAR" property="studentNumber" />
    <result column="head_img" jdbcType="VARCHAR" property="headImg" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="banji" jdbcType="INTEGER" property="banji" />
    <result column="bus_morning" jdbcType="INTEGER" property="busMorning" />
    <result column="bus_afternoon" jdbcType="INTEGER" property="busAfternoon" />
    <result column="board_station_morning" jdbcType="INTEGER" property="boardStationMorning" />
    <result column="board_station_afternoon" jdbcType="INTEGER" property="boardStationAfternoon" />
    <result column="family_info" jdbcType="LONGVARCHAR" property="familyInfo" />

    <result column="banji_name" jdbcType="VARCHAR" property="banjiName" />
    <result column="bus_number" jdbcType="VARCHAR" property="busNumber" />
    <result column="board_station_morning_name" jdbcType="VARCHAR" property="boardStationMorningName" />
    <result column="board_station_afternoon_name" jdbcType="VARCHAR" property="boardStationAfternoonName" />
  </resultMap>

  <select id="getPlannedStudentsByBusNumberAndBusMode" resultMap="StudentInfoResultMap">
    SELECT
      student.*,
      bus.number as bus_number
    FROM
	  student
    <if test="busMode != null and busMode != '' and busMode == '上午接送'">
      LEFT JOIN bus ON student.bus_morning = bus.id
      WHERE
      bus.number =#{busNumber}
    </if>
    <if test="busMode != null and busMode != '' and busMode == '下午接送'">
      LEFT JOIN bus ON student.bus_afternoon = bus.id
      WHERE
      bus.number =#{busNumber}
    </if>
  </select>

</mapper>