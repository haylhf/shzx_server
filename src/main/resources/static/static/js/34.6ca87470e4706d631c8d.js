webpackJsonp([34],{"2byv":function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=l("//Fk"),n=l.n(a),r=l("D2/k"),i=l("o1Jv"),s=l("vt++"),c={name:"client_manage",components:{},data:function(){return o=this,{isError:!1,errorMsg:"",totalRecords:0,selectedItem:{},deleteConfirmVisible:!1,tableData:[],pageSize:s.a.EveryPageNum,currentPage:1,startRow:1,addDialogVisible:!1,form:{account:"",name:"",roleId:"",agent:"",phone:"",address:"",customerCompany:""},formLabelWidth:"100px",modifyDialogVisible:!1,modifyForm:{account:"",name:"",roleId:"",agent:"",phone:"",address:"",customerCompany:""},filters:{name:"",account:"",roleId:"",isAgent:!0,agent:""},allRoles:[],allAgents:[],allMarketGroups:[],loadingUI:!1,currentUserAgent:0}},methods:{onChange:function(){o.addDialogVisible?o.isError=o.validateForm(o.form,!1):o.isError=o.validateForm(o.modifyForm,!0)},handleSizeChange:function(e){},handleCurrentChange:function(e){this.currentPage=e,this.onSelectUsers()},search:function(){o.onSelectUsers()},onSelectUsers:function(){o.tableData=new Array,o.loadingUI=!0,o.filters.valid=1,o.filters.page=o.currentPage,o.filters.size=o.pageSize,o.filters.userType=s.a.USER_TYPE_CUSTOMER,0!=this.currentUserAgent&&(o.filters.currentUserAgent=this.currentUserAgent),Object(r.f)(o.filters).then(function(e){200==e.data.code?(o.totalRecords=e.data.data.total,o.tableData=e.data.data.list,o.startRow=e.data.data.startRow,o.loadingUI=!1):(n.a.reject("获取用户信息错误！"),o.loadingUI=!1)})},handleAdd:function(){this.isError=!1,this.errorMsg="",this.addDialogVisible=!0,this.form.agent=0!=this.currentUserAgent?this.currentUserAgent:""},handleEdit:function(e){this.isError=!1,this.errorMsg="",this.selectedItem=e,this.modifyForm.id=e.id,this.modifyForm.account=e.account,this.modifyForm.name=e.name,this.modifyForm.agent=e.agent,this.modifyForm.phone=e.phone,this.modifyForm.roleId=e.roleId,this.modifyForm.valid=e.valid,this.modifyForm.customerCompany=e.customerCompany,this.modifyForm.address=e.address,this.isError=this.validateForm(this.modifyForm,!0),this.modifyDialogVisible=!0},handleDelete:function(e,t){this.selectedItem=copyObject(t),this.selectedItem&&(o.deleteConfirmVisible=!0)},onConfirmDelete:function(){var e=this;o.deleteConfirmVisible=!1;var t={id:this.selectedItem.id,valid:0};Object(r.h)(t).then(function(t){responseIsOK(t)?(showMSG(o,"删除客户成功！",1),o.deleteConfirmVisible=!1,e.onSelectUsers()):showMessage(o,isStringEmpty(t.data.message)?"删除客户失败！":t.data.message)})},validateForm:function(e,t){var l=!1;return!l&&isStringEmpty(e.account)&&(l=!0,this.errorMsg="账号不能为空"),!l&&isStringEmpty(e.name)&&(l=!0,this.errorMsg="姓名不能为空"),!l&&isStringEmpty(e.phone)&&(l=!0,this.errorMsg="联系方式不能为空"),!l&&isStringEmpty(e.customerCompany)&&(l=!0,this.errorMsg="公司名称不能为空"),l||isPoneAvailable(e.phone)||(l=!0,this.errorMsg="手机号格式不正确"),l||""!=e.roleId||(l=!0,this.errorMsg="请选择角色"),l||(this.errorMsg=""),l},onAdd:function(){var e=this;this.isError=o.validateForm(this.form,!1),this.isError||Object(r.b)(this.form).then(function(t){responseIsOK(t)?(showMSG(o,"添加客户成功！",1),o.addDialogVisible=!1,e.onSelectUsers()):showMessage(o,isStringEmpty(t.data.message)?"添加客户失败！":t.data.message)})},onEidt:function(){var e=this;this.isError=this.validateForm(this.modifyForm,!0),o.isError||Object(r.h)(this.modifyForm).then(function(t){responseIsOK(t)?(showMSG(o,"修改客户信息成功！",1),o.modifyDialogVisible=!1,e.onSelectUsers()):showMessage(o,isStringEmpty(t.data.message)?"修改客户信息失败！":t.data.message)})},initAllRoles:function(){Object(r.e)().then(function(e){200==e.data.code?(o.allRoles=e.data.data.list.filter(function(e){return-1!=e.roleName.indexOf("客户")||-1!=e.roleName.indexOf("联系人")}),n.a.resolve()):n.a.reject("获取角色信息错误！")})},initAllAgent:function(){Object(i.a)().then(function(e){if(200==e.data.code){var t=e.data.data.list;o.allAgents.slice(0,o.allAgents.length),o.allAgents.push({id:0,name:" "});for(var l=0;l<t.length;l++)o.allAgents.push(t[l])}else n.a.reject("获取代理商信息错误！")})}},computed:{},filters:{filterRole:function(e){for(var t=0;t<o.allRoles.length;t++)if(o.allRoles[t].id==e)return o.allRoles[t].roleName;return""},filterAgent:function(e){for(var t=0;t<o.allAgents.length;t++)if(o.allAgents[t].id==e)return o.allAgents[t].name;return""}},created:function(){this.currentUserAgent=o.$store.getters.user.user.agent,this.initAllRoles(),this.initAllAgent()},mounted:function(){this.onSelectUsers()}},m={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"root_div"},[l("el-form",{attrs:{model:e.filters,"label-position":"right","label-width":"60px"}},[l("el-row",[l("el-col",{attrs:{span:3}},[l("el-form-item",{attrs:{label:"账号:"}},[l("el-input",{attrs:{placeholder:"账号","auto-complete":"off",clearable:""},model:{value:e.filters.account,callback:function(t){e.$set(e.filters,"account",t)},expression:"filters.account"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:3}},[l("el-form-item",{attrs:{label:"姓名:"}},[l("el-input",{attrs:{placeholder:"姓名","auto-complete":"off",clearable:""},model:{value:e.filters.name,callback:function(t){e.$set(e.filters,"name",t)},expression:"filters.name"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:4}},[l("el-form-item",{attrs:{label:"角色:"}},[l("el-select",{attrs:{clearable:""},model:{value:e.filters.roleId,callback:function(t){e.$set(e.filters,"roleId",t)},expression:"filters.roleId"}},e._l(e.allRoles,function(e){return l("el-option",{attrs:{value:e.id,label:e.roleName}})}))],1)],1),e._v(" "),0==e.currentUserAgent?l("el-col",{attrs:{span:4}},[l("el-form-item",{attrs:{label:"显示代理商:","label-width":"90px"}},[l("el-switch",{attrs:{"active-text":"是","inactive-text":"否"},model:{value:e.filters.isAgent,callback:function(t){e.$set(e.filters,"isAgent",t)},expression:"filters.isAgent"}})],1)],1):e._e(),e._v(" "),0==e.currentUserAgent?l("el-col",{attrs:{span:4}},[e.filters.isAgent?l("el-form-item",{attrs:{label:"代理商:"}},[l("el-select",{attrs:{clearable:""},model:{value:e.filters.agent,callback:function(t){e.$set(e.filters,"agent",t)},expression:"filters.agent"}},e._l(e.allAgents,function(e){return l("el-option",{attrs:{value:e.id,label:e.name}})}))],1):e._e()],1):e._e(),e._v(" "),l("el-col",{attrs:{span:2}},[l("el-button",{attrs:{icon:"el-icon-search",size:"normal",type:"primary"},on:{click:e.search}},[e._v("搜索\n                    ")])],1),e._v(" "),l("el-button",{staticStyle:{float:"right"},attrs:{icon:"el-icon-plus",size:"normal",type:"primary"},on:{click:e.handleAdd}},[e._v("客户\n                ")])],1)],1),e._v(" "),l("el-row",[l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingUI,expression:"loadingUI"}],staticStyle:{width:"100%"},attrs:{"element-loading-text":"获取数据中...",data:e.tableData,border:""}},[l("el-table-column",{attrs:{width:"75",align:"center",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.$index+e.startRow)+"\n                    ")]}}])}),e._v(" "),l("el-table-column",{attrs:{align:"center",prop:"account",label:"账号"}}),e._v(" "),l("el-table-column",{attrs:{align:"center",prop:"name",label:"姓名"}}),e._v(" "),l("el-table-column",{attrs:{align:"center",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e._f("filterRole")(t.row.roleId))+"\n                    ")]}}])}),e._v(" "),l("el-table-column",{attrs:{align:"center",prop:"customerCompany",label:"公司名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(0==t.row.customerCompany||null==t.row.customerCompany?"":t.row.customerCompany)+"\n                    ")]}}])}),e._v(" "),l("el-table-column",{attrs:{align:"center",prop:"phone",label:"联系方式"}}),e._v(" "),l("el-table-column",{attrs:{align:"center",prop:"address",label:"地址"}}),e._v(" "),l("el-table-column",{attrs:{align:"center",label:"代理商"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e._f("filterAgent")(t.row.agent))+"\n                    ")]}}])}),e._v(" "),l("el-table-column",{attrs:{align:"center",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{size:"small",icon:"el-icon-edit",type:"primary"},on:{click:function(l){e.handleEdit(t.row)}}},[e._v("编辑\n                        ")]),e._v(" "),l("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-delete",disabled:"admin"==t.row.account},on:{click:function(l){e.handleDelete(t.$index,t.row)}}},[e._v("删除\n                        ")])]}}])})],1),e._v(" "),l("div",{staticClass:"block",staticStyle:{"text-align":"center","margin-top":"20px"}},[l("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.totalRecords},on:{"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),l("el-dialog",{attrs:{title:"增加用户",visible:e.addDialogVisible,width:"60%"},on:{"update:visible":function(t){e.addDialogVisible=t}}},[l("el-form",{attrs:{model:e.form}},[l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"账号：","label-width":e.formLabelWidth}},[l("el-input",{on:{change:e.onChange},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"姓名：","label-width":e.formLabelWidth}},[l("el-input",{on:{change:e.onChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"联系方式：","label-width":e.formLabelWidth}},[l("el-input",{on:{change:e.onChange},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"公司名称：","label-width":e.formLabelWidth}},[l("el-input",{on:{change:e.onChange},model:{value:e.form.customerCompany,callback:function(t){e.$set(e.form,"customerCompany",t)},expression:"form.customerCompany"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"地址：","label-width":e.formLabelWidth}},[l("el-input",{on:{change:e.onChange},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"角色：","label-width":e.formLabelWidth}},[l("el-select",{on:{change:e.onChange},model:{value:e.form.roleId,callback:function(t){e.$set(e.form,"roleId",t)},expression:"form.roleId"}},e._l(e.allRoles,function(e){return l("el-option",{attrs:{value:e.id,label:e.roleName}})}))],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"代理商：","label-width":e.formLabelWidth}},[l("el-select",{attrs:{clearable:"",disabled:0!=e.currentUserAgent},on:{change:e.onChange},model:{value:e.form.agent,callback:function(t){e.$set(e.form,"agent",t)},expression:"form.agent"}},e._l(e.allAgents,function(e){return l("el-option",{attrs:{value:e.id,label:e.name}})}))],1)],1)],1),e._v(" "),e.isError?l("el-alert",{staticStyle:{"margin-top":"10px",padding:"5px"},attrs:{title:e.errorMsg,type:"error",closable:!1,"show-icon":""}}):e._e(),e._v(" "),l("div",{staticClass:"dialog-footer",staticStyle:{"margin-bottom":"20px","margin-top":"100px"},attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{icon:"el-icon-close",type:"danger"},on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.onAdd}},[e._v("确 定")])],1)],1),e._v(" "),l("el-dialog",{attrs:{title:"编辑用户",visible:e.modifyDialogVisible,width:"60%"},on:{"update:visible":function(t){e.modifyDialogVisible=t}}},[l("el-form",{attrs:{model:e.modifyForm}},[l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"账号：","label-width":e.formLabelWidth}},[l("el-input",{attrs:{disabled:"admin"==e.modifyForm.account},on:{change:e.onChange},model:{value:e.modifyForm.account,callback:function(t){e.$set(e.modifyForm,"account",t)},expression:"modifyForm.account"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"姓名：","label-width":e.formLabelWidth}},[l("el-input",{on:{change:e.onChange},model:{value:e.modifyForm.name,callback:function(t){e.$set(e.modifyForm,"name",t)},expression:"modifyForm.name"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"联系方式：","label-width":e.formLabelWidth}},[l("el-input",{on:{change:e.onChange},model:{value:e.modifyForm.phone,callback:function(t){e.$set(e.modifyForm,"phone",t)},expression:"modifyForm.phone"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"公司名称：","label-width":e.formLabelWidth}},[l("el-input",{on:{change:e.onChange},model:{value:e.modifyForm.customerCompany,callback:function(t){e.$set(e.modifyForm,"customerCompany",t)},expression:"modifyForm.customerCompany"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"地址：","label-width":e.formLabelWidth}},[l("el-input",{on:{change:e.onChange},model:{value:e.modifyForm.address,callback:function(t){e.$set(e.modifyForm,"address",t)},expression:"modifyForm.address"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"角色：","label-width":e.formLabelWidth}},[l("el-select",{on:{change:e.onChange},model:{value:e.modifyForm.roleId,callback:function(t){e.$set(e.modifyForm,"roleId",t)},expression:"modifyForm.roleId"}},e._l(e.allRoles,function(e){return l("el-option",{attrs:{value:e.id,label:e.roleName}})}))],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"代理商：","label-width":e.formLabelWidth}},[l("el-select",{attrs:{clearable:"",disabled:0!=e.currentUserAgent},on:{change:e.onChange},model:{value:e.modifyForm.agent,callback:function(t){e.$set(e.modifyForm,"agent",t)},expression:"modifyForm.agent"}},e._l(e.allAgents,function(e){return l("el-option",{attrs:{value:e.id,label:e.name}})}))],1)],1)],1),e._v(" "),e.isError?l("el-alert",{staticStyle:{"margin-top":"10px",padding:"5px"},attrs:{title:e.errorMsg,type:"error",closable:!1,"show-icon":""}}):e._e(),e._v(" "),l("div",{staticClass:"dialog-footer",staticStyle:{"margin-bottom":"20px","margin-top":"100px"},attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{icon:"el-icon-close",type:"danger"},on:{click:function(t){e.modifyDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.onEidt}},[e._v("确 定")])],1)],1),e._v(" "),l("el-dialog",{attrs:{title:"提示",visible:e.deleteConfirmVisible,width:"30%"},on:{"update:visible":function(t){e.deleteConfirmVisible=t}}},[l("span",[e._v("确认要删除账号为[ "),l("b",[e._v(e._s(e.selectedItem.account))]),e._v(" ]的用户吗？")]),e._v(" "),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{icon:"el-icon-close"},on:{click:function(t){e.deleteConfirmVisible=!1}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.onConfirmDelete}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var d=l("VU/8")(c,m,!1,function(e){l("fcJe")},"data-v-1cf88919",null);t.default=d.exports},d217:function(e,t,l){(e.exports=l("FZ+f")(!1)).push([e.i,"\n.root_div[data-v-1cf88919] {\n    position: relative;\n    padding: 20px;\n    width: 100%;\n    height: 85vh;\n}\n",""])},fcJe:function(e,t,l){var o=l("d217");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);l("rjj0")("5957bc54",o,!0)}});