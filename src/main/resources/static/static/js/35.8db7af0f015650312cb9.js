webpackJsonp([35],{Odm3:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=a("woOf"),r=a.n(o),l=a("BO1k"),i=a.n(l),s=a("vt++"),c=(a("zL8q"),a("QSzI")),u=a("weGg"),m=a("0xDb"),d=(a("IcnI"),{name:"assign_machine",components:{},data:function(){return n=this,{tableData:[],pageSize:s.a.EveryPageNum,currentPage:1,startRow:0,totalRecords:0,statusList:s.a.MachineStatusList,condition:{nameplate:"",orderNum:"",machineType:"",customer:"",isAgent:!0,agent:"",status:"",selectDate:""},showAssignDialog:!1,selectedItem:{},customerList:[],customerTimeout:null,dataform:{},machineTableData:[],multipleSelection:[],allMachineType:[],allRoles:[],loadingUI:!1,pickerOptions:s.a.DateOptions}},computed:{agentName:{get:function(){var e="";return isStringEmpty(n.dataform.customerName)||n.customerList.forEach(function(t){if(t.value==n.dataform.customerName)return e=t.agentName}),e}}},filters:{filterDateString:function(e){return isStringEmpty(e)?"":new Date(e).format("yyyy-MM-dd")},filterStatus:function(e){for(var t=n.statusList[0].name,a=0;a<n.statusList.length;a++)if(e==n.statusList[a].value){t=n.statusList[a].name;break}return t},filterMachineType:function(e){for(var t="",a=0;a<n.allMachineType.length;a++)if(e==n.allMachineType[a].id){t=n.allMachineType[a].name;break}return t}},methods:{setCanSelect:function(e,t){return 0==e.status},handleCurrentChange:function(e){this.currentPage=e,this.search()},search:function(){this.onSearchDetailData()},onSearchDetailData:function(){var e={orderNum:this.condition.orderNum.trim(),nameplate:this.condition.nameplate.trim(),isFuzzy:!0,page:this.currentPage,size:this.pageSize};Object(c.i)(e).then(function(e){responseIsOK(e)?(n.tableData=e.data.data.list,n.totalRecords=e.data.data.total,n.startRow=e.data.data.startRow):showMSG(n,isStringEmpty(e.data.message)?"查询数据失败！":e.data.message)})},handleSelectionChange:function(e){n.multipleSelection=e},onBindMachine:function(){if(isStringEmpty(n.dataform.customerName))showMSG(n,"客户不能为空!");else if(isStringEmpty(n.dataform.factoryDate))showMSG(n,"出厂日期不能为空!");else{null!=this.dataform.factoryDate&&this.dataform.factoryDate.length>0&&(this.dataform.factoryDate=this.dataform.factoryDate.format("yyyy-MM-dd"));var e=[],t=0,a=!0,o=!1,l=void 0;try{for(var s,u=i()(n.customerList);!(a=(s=u.next()).done);a=!0){var m=s.value;if(m.value==n.dataform.customerName){t=m.id;break}}}catch(e){o=!0,l=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw l}}var d=!0,f=!1,p=void 0;try{for(var h,g=i()(n.multipleSelection);!(d=(h=g.next()).done);d=!0){var v=h.value,y=r()({customer:t,facoryDate:n.dataform.factoryDate,customerInContract:v.customerName,nameplate:v.nameplate,orderNum:v.orderNum,contractNum:v.contractNum,geoLocation:v.geoLocation,address:v.address,status:"1",machineType:v.machineTypeName,needleNum:v.needleNum,xDistance:v.xDistance,yDistance:v.yDistance,headDistance:v.headDistance,headNum:v.headNum,isOldMachine:"0"});e.push(y)}}catch(e){f=!0,p=e}finally{try{!d&&g.return&&g.return()}finally{if(f)throw p}}Object(c.b)(e).then(function(e){n.showAssignDialog=!1,responseIsOK(e)?(showMessage(n,"绑定成功!",1),n.onSearchDetailData()):showMessage(n,"绑定失败!"+e.data.message)})}},editWithItem:function(e){Object(m.b)(this.dataform),n.machineTableData=[],n.selectedItem=r()({},e),n.dataform.orderNum=n.selectedItem.orderNum,n.showAssignDialog=!0;var t={orderNum:n.selectedItem.orderNum,nameplate:"",isFuzzy:!1,page:0,size:0};Object(c.i)(t).then(function(e){responseIsOK(e)&&(n.machineTableData=e.data.data.list)})},initCustomerList:function(){var e={roleId:s.a.UserType.Customer};Object(u.e)(e).then(function(e){if(responseIsOK(e)){n.customerList=[];var t=!0,a=!1,o=void 0;try{for(var r,l=i()(e.data.data.list);!(t=(r=l.next()).done);t=!0){var s=r.value;n.customerList.push({value:s.name,id:s.id,agent:s.agent,agentName:s.agentName})}}catch(e){a=!0,o=e}finally{try{!t&&l.return&&l.return()}finally{if(a)throw o}}}})},queryCustomer:function(e,t){var a=n.customerList;e&&(a=n.customerList.filter(function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>=0})),clearTimeout(n.customerTimeout),n.customerTimeout=setTimeout(function(){t(a)},800*Math.random())},createStateFilter:function(e){return function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>=0}},initData:function(){n.initCustomerList(),n.$store.getters.commonData.machineTypeList.length>0?n.allMachineType=n.$store.getters.commonData.machineTypeList:n.$store.dispatch("getAllMachineType").then(function(){n.allMachineType=n.$store.getters.commonData.machineTypeList}).catch(function(e){showMSG(n,"getAllMachineType failed!")})}},created:function(){this.initData(),this.search()}}),f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"assign_machine_div"},[a("div",[a("el-col",{staticClass:"well well-lg",staticStyle:{"background-color":"white"}},[a("el-form",{attrs:{model:e.condition,"label-position":"right","label-width":"90px"}},[a("el-row",[a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"机器编号:"}},[a("el-input",{attrs:{placeholder:"机器编号",clearable:"","auto-complete":"off"},model:{value:e.condition.nameplate,callback:function(t){e.$set(e.condition,"nameplate",t)},expression:"condition.nameplate"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"订单编号:"}},[a("el-input",{attrs:{placeholder:"订单号",clearable:"","auto-complete":"off"},model:{value:e.condition.orderNum,callback:function(t){e.$set(e.condition,"orderNum",t)},expression:"condition.orderNum"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:2,offset:12}},[a("el-button",{attrs:{icon:"el-icon-search",size:"normal",type:"primary"},on:{click:e.search}},[e._v("查询\n                            ")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingUI,expression:"loadingUI"}],ref:"singleTable",staticStyle:{width:"100%"},attrs:{"element-loading-text":"获取数据中...",data:e.tableData,border:"","empty-text":"暂无数据...","highlight-current-row":"","show-overflow-tooltip":"true"}},[a("el-table-column",{attrs:{width:"75",align:"center",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(t.$index+e.startRow+1)+"\n                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"nameplate",label:"机器编号"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"machineType",label:"机型"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("\n                                "+e._s(e._f("filterMachineType")(t.row.machineType))+"\n                            ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"订单号",align:"center",prop:"orderNum"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("\n                                "+e._s(t.row.orderNum)+"\n                            ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"交货日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("\n                            "+e._s(e._f("filterDateString")(t.row.shipTime))+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"100",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{placement:"top",content:"分配"}},[a("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-news"},on:{click:function(a){e.editWithItem(t.row)}}})],1)]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"分配机器",visible:e.showAssignDialog,"append-to-body":"",width:"90%"},on:{"update:visible":function(t){e.showAssignDialog=t}}},[a("el-col",{staticClass:"well well-lg",staticStyle:{"background-color":"white"}},[a("el-form",{attrs:{model:e.dataform,"label-position":"right","label-width":"90px"}},[a("el-row",[a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"订单编号:"}},[a("span",{domProps:{innerHTML:e._s(e.dataform.orderNum)}})])],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"客户:"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.queryCustomer,placeholder:"客户"},model:{value:e.dataform.customerName,callback:function(t){e.$set(e.dataform,"customerName",t)},expression:"dataform.customerName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"代理商:"}},[a("span",{domProps:{innerHTML:e._s(e.agentName)}})])],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"出厂日期:"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"出厂日期",align:"left","picker-options":e.pickerOptions},model:{value:e.dataform.factoryDate,callback:function(t){e.$set(e.dataform,"factoryDate",t)},expression:"dataform.factoryDate"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:2,offset:2}},[a("el-button",{attrs:{disabled:0==e.multipleSelection.length,icon:"el-icon-setting",size:"normal",type:"primary"},on:{click:e.onBindMachine}},[e._v("绑定\n                                ")])],1)],1)],1),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"element-loading-text":"获取数据中...",data:e.machineTableData,border:"","empty-text":"暂无数据...","show-overflow-tooltip":"true"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",selectable:e.setCanSelect,width:"55"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"nameplate",label:"机器编号"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"machineTypeName",label:"机型"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("\n                                    "+e._s(e._f("filterMachineType")(t.row.machineType))+"\n                                ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"订单号",align:"center",prop:"orderNum"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("\n                                    "+e._s(t.row.orderNum)+"\n                                ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"customerName",label:"客户"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"agent",label:"代理商"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"安装状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?a("div",{staticStyle:{color:"green"}},[e._v("\n                                    未绑定\n                                ")]):a("div",{staticStyle:{color:"red"}},[e._v("\n                                    已绑定\n                                ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"交货日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("\n                            "+e._s(e._f("filterDateString")(t.row.shipTime))+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"出厂日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("\n                            "+e._s(e._f("filterDateString")(t.row.factoryDate))+"\n                        ")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"margin-bottom":"20px"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{icon:"el-icon-back"},on:{click:function(t){e.showAssignDialog=!1}}},[e._v("关闭")])],1)],1)],1)])},staticRenderFns:[]};var p=a("VU/8")(d,f,!1,function(e){a("sL1j")},"data-v-19d163ae",null);t.default=p.exports},sL1j:function(e,t,a){var n=a("z7qk");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("551de5ce",n,!0)},z7qk:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.assign_machine_div[data-v-19d163ae] {\n\t    position: relative;\n\t    padding: 20px;\n\t    width: 100%;\n\t    height: 85vh;\n}\n",""])}});